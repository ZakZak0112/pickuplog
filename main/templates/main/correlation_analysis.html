{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-3">ğŸŒ¦ ìƒê´€ê´€ê³„ ë¶„ì„ (Correlation Analysis)</h2>
  <p class="text-muted">ìµœê·¼ 30ì¼ê°„ ë‚ ì”¨, ê¸°ì˜¨, í˜¼ì¡ë„ì™€ ë¶„ì‹¤ë¥  ê°„ì˜ ìƒê´€ê´€ê³„ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.</p>

  {% if merged %}
  <div class="card p-3 mb-4">
    <h5>ğŸ“ˆ ìƒê´€ê³„ìˆ˜ ê²°ê³¼</h5>
    <table class="table table-striped">
      <thead><tr><th>ì§€í‘œ</th><th>ìƒê´€ê³„ìˆ˜ (r)</th></tr></thead>
      <tbody>
        <tr><td>í‰ê·  ê¸°ì˜¨ â†” ë¶„ì‹¤ë¥ </td><td>{{ temp_corr }}</td></tr>
        <tr><td>ê°•ìˆ˜ëŸ‰ â†” ë¶„ì‹¤ë¥ </td><td>{{ rain_corr }}</td></tr>
      </tbody>
    </table>
  </div>

  <div class="row">
    <div class="col-md-6">
      <canvas id="tempChart"></canvas>
    </div>
    <div class="col-md-6">
      <canvas id="rainChart"></canvas>
    </div>
  </div>

  <!-- JSON ì•ˆì „í•˜ê²Œ ì‹¬ê¸° -->
  {{ merged|json_script:"merged-data" }}

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const merged = JSON.parse(document.getElementById('merged-data').textContent);

    const labels = merged.map(m => m.date);
    const lost = merged.map(m => m.lost);

    new Chart(document.getElementById('tempChart'), {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: 'í‰ê·  ê¸°ì˜¨ (Â°C)',
          data: merged.map(m => m.temp),
          borderColor: 'rgba(255,99,132,1)',
          yAxisID: 'y1'
        },{
          label: 'ë¶„ì‹¤ë¬¼ ìˆ˜',
          data: lost,
          borderColor: 'rgba(54,162,235,1)',
          yAxisID: 'y2'
        }]
      },
      options: {
        plugins: { title: { display: true, text: 'ê¸°ì˜¨ vs ë¶„ì‹¤ë¬¼ ì¶”ì„¸' } },
        scales: { y1: { type: 'linear', position: 'left' }, y2: { type: 'linear', position: 'right' } }
      }
    });

    new Chart(document.getElementById('rainChart'), {
      type: 'line',
      data: {
        labels,
        datasets: [{
          label: 'ê°•ìˆ˜ëŸ‰ (mm)',
          data: merged.map(m => m.rain),
          borderColor: 'rgba(75,192,192,1)',
          yAxisID: 'y1'
        },{
          label: 'ë¶„ì‹¤ë¬¼ ìˆ˜',
          data: lost,
          borderColor: 'rgba(255,159,64,1)',
          yAxisID: 'y2'
        }]
      },
      options: {
        plugins: { title: { display: true, text: 'ê°•ìˆ˜ëŸ‰ vs ë¶„ì‹¤ë¬¼ ì¶”ì„¸' } },
        scales: { y1: { type: 'linear', position: 'left' }, y2: { type: 'linear', position: 'right' } }
      }
    });
  </script>

  {% else %}
  <p class="text-center mt-5">ğŸ” ë¶„ì„ ê°€ëŠ¥í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endif %}
</div>
{% endblock %}
