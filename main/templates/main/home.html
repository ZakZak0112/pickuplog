{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>PickUpLog: ì˜¤ëŠ˜ì˜ ë¶„ì‹¤ ì˜ˆë³´</title>
    <style>
        /* ë¶„ì„ ë¦¬í¬íŠ¸ì˜ ê°€ë…ì„±ì„ ìœ„í•œ ì„ì‹œ ìŠ¤íƒ€ì¼ */
        body { font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', Arial, sans-serif; margin: 40px; background-color: #f4f4f4; }
        .report-box { 
            background-color: white; 
            border: 1px solid #ddd; 
            padding: 25px; 
            border-radius: 10px; 
            max-width: 550px; /* ë„ˆë¹„ í™•ì¥ */
            margin: 20px auto; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); /* ê·¸ë¦¼ì ê°•í™” */
            display: grid;
            gap: 20px;
        }
        .header h2 { margin-top: 0; color: #1e88e5; font-size: 2em; }
        .prediction-value { font-size: 2.5em; font-weight: bold; color: #d32f2f; } /* ë¶„ì‹¤ë¥  ê°•ì¡° */
        
        .list-item { 
            font-size: 1.1em; 
            padding: 8px 0; 
            border-bottom: 1px dotted #eee;
        }
        .list-item:last-child { border-bottom: none; }
        
        .warning-box { 
            color: #d32f2f; 
            font-weight: bold; 
            margin-top: 20px; 
            padding: 15px; 
            background-color: #ffebee;
            border-radius: 6px;
            border-left: 5px solid #d32f2f;
        }
        .rii-detail { 
            margin-top: 20px; 
            padding-top: 15px; 
            border-top: 1px solid #eee;
        }
    </style>
</head>
<body>

    <div class="report-box">
        
        <form method="GET" action="/">
            <h3>ë¶„ì‹¤ ì˜ˆë³´ ì¡°ê±´ ì„¤ì •</h3>
            <label for="line" style="font-weight: bold;">ë…¸ì„ :</label>
            <select name="line" id="line">
                <option value="ì„ íƒ">ì„ íƒ</option>
                <option value="LINE1" {% if line == 'LINE1' %}selected{% endif %}>1í˜¸ì„ </option>
                <option value="LINE2" {% if line == 'LINE2' %}selected{% endif %}>2í˜¸ì„ </option>
                <option value="LINE3" {% if line == 'LINE3' %}selected{% endif %}>3í˜¸ì„ </option>
                <option value="LINE4" {% if line == 'LINE4' %}selected{% endif %}>4í˜¸ì„ </option>
                <option value="LINE5" {% if line == 'LINE5' %}selected{% endif %}>5í˜¸ì„ </option>
                <option value="LINE6" {% if line == 'LINE6' %}selected{% endif %}>6í˜¸ì„ </option>
                <option value="LINE7" {% if line == 'LINE7' %}selected{% endif %}>7í˜¸ì„ </option>
                <option value="LINE8" {% if line == 'LINE8' %}selected{% endif %}>8í˜¸ì„ </option>
                <option value="LINE9" {% if line == 'LINE9' %}selected{% endif %}>9í˜¸ì„ </option>
            </select>
            
            <label for="condition" style="font-weight: bold; margin-left: 20px;">ë‚ ì”¨:</label>
            <select name="condition" id="condition">
                <option value="í‰ì†Œ" {% if date_condition == 'í‰ì†Œ' %}selected{% endif %}>í‰ì†Œ</option>
                <option value="ë¹„ì˜¤ëŠ” ë‚ " {% if date_condition == 'ë¹„ì˜¤ëŠ” ë‚ ' %}selected{% endif %}>ë¹„ì˜¤ëŠ” ë‚ </option>
            </select>
            <button type="submit" style="padding: 5px 10px; margin-left: 10px; background-color: #1e88e5; color: white; border: none; border-radius: 4px;">ì˜ˆë³´ í™•ì¸</button>
        </form>

        <hr>
        
        <div class="header">
            <h2>ğŸš‡ ì˜¤ëŠ˜ì˜ ë¶„ì‹¤ ì˜ˆë³´</h2>
            <p><strong>{{ line|default:"ë…¸ì„  ë¯¸ì„ íƒ" }}</strong> (ì¡°ê±´: {{ date_condition|default:"í‰ì†Œ" }})</p>
            <small>ë¶„ì„ ê¸°ì¤€ ë°ì´í„°: {{ current_date|date:"Yë…„ mì›” dì¼" }}</small>
        </div>
        
        <div>
            <h3>ì˜ˆìƒ ë¶„ì‹¤ë¥  (Loss Rate per 10k)</h3>
            <div class="prediction-value">
                {{ total_predicted_loss|floatformat:2|default:"N.A" }}ê±´
            </div>
            <p style="margin-top: 5px; color: #555;">
                1ë§Œ ëª… ìŠ¹í•˜ì°¨ ë‹¹ ì˜ˆìƒ ë¶„ì‹¤ë¬¼ ìˆ˜ì¹˜ì…ë‹ˆë‹¤. (RII ë° í˜¼ì¡ë„ ê°€ì¤‘ì¹˜ ë°˜ì˜)
            </p>
        </div>

        <div class="warning-box">
            ğŸ“¢ **ì§‘ì¤‘ ì˜ˆë³´: ìš°ì‚° ë¶„ì‹¤ ìœ„í—˜ {{ umbrella_impact_ratio|floatformat:1 }}ë°° ì¦ê°€.**
            <p style="font-size: 0.9em; margin-top: 5px; color: #880000;">
                RII(Rain Impact Index) ë¶„ì„ì— ë”°ë¼, ë¹„ ì˜¤ëŠ” ë‚ ì—ëŠ” ìš°ì‚° ë° ìŠµê¸° ê´€ë ¨ ë¬¼í’ˆì˜ ë¶„ì‹¤ë¥ ì´
                <span style="font-weight: 900;">{{ umbrella_impact_ratio|floatformat:1 }}ë°°</span>ê¹Œì§€ ì¦ê°€í•˜ëŠ” ê²ƒìœ¼ë¡œ ì§‘ê³„ë©ë‹ˆë‹¤.
            </p>
        </div>

        <div>
            <h3>ì£¼ìš” ë¶„ì‹¤ ì¹´í…Œê³ ë¦¬ ê¸°ì—¬ìœ¨</h3>
            <div style="border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
                {% for item in items %}
                    <div class="list-item">
                        <span style="font-weight: bold;">{{ forloop.counter }}. {{ item.category|default:"N/A" }}</span>
                        <span style="float: right; color: #1e88e5;">{{ item.rate|floatformat:1 }}%</span>
                    </div>
                {% empty %}
                    <p>ë°ì´í„° ë¶€ì¡±ìœ¼ë¡œ ì¹´í…Œê³ ë¦¬ ê¸°ì—¬ìœ¨ì„ ì œê³µí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                {% endfor %}
            </div>
        </div>

        <div class="rii-detail">
            <h4>ë…¸ì„ ë³„ RII ìƒì„¸</h4>
            <table style="width: 100%; border-collapse: collapse; text-align: left;">
                <thead style="background-color: #eee;">
                    <tr>
                        <th style="padding: 8px; border: 1px solid #ddd;">ë…¸ì„ </th>
                        <th style="padding: 8px; border: 1px solid #ddd;">RII</th>
                    </tr>
                </thead>
                <tbody>
                    {% for report in latest_reports %}
                    <tr>
                        <td style="padding: 8px; border: 1px solid #ddd;">{{ report.line_code }}í˜¸ì„ </td>
                        <td style="padding: 8px; border: 1px solid #ddd; font-weight: bold;">{{ report.rain_impact_index|floatformat:2 }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" style="padding: 8px; border: 1px solid #ddd; text-align: center; color: #777;">ë¶„ì„ ë³´ê³ ì„œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
    </div>

</body>
</html>